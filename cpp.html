<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MANGO: Calling MANGO from C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cpp.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Calling MANGO from C++ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The use of MANGO from a C++ application is described here. For a demonstration of the concepts here, you are strongly encouraged to look at the <a href="https://github.com/hiddenSymmetries/mango/tree/master/examples/src">examples in the git repository</a>.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Connecting your code to MANGO</h1>
<p>To use MANGO from your C++ application, you must include MANGO's header file from your source code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="mango_8hpp.html">mango.hpp</a>&quot;</span></div>
</div><!-- fragment --><p>When compiling your code, make sure the compiler is able to find <code><a class="el" href="mango_8hpp.html">mango.hpp</a></code>. This file is located in the <code>include</code> subdirectory of MANGO. Typically the compiler can be instructed to look in this directory with a flag such as <code>-I &lt;mangodir&gt;/include</code> where <code>&lt;mangodir&gt;</code> is replaced by the appropriate directory on your system.</p>
<p>To link your code to MANGO, link to the file <code>libmango.a</code>, which is located in MANGO's <code>lib</code> subdirectory. Typically the linker can be instructed to link to this file with flags such as <code>-L &lt;mangodir&gt;/lib -lmango</code>, where <code>&lt;mangodir&gt;</code> is replaced by the appropriate directory on your system.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Defining an objective function</h1>
<p>For general optimization problems, the objective function is determined by a user-supplied subroutine with the form <a class="el" href="namespacemango.html#a00722de214a374d91aff46c5c42d00be" title="Format for the user-supplied subroutine that computes the objective function for a general (non least...">mango::objective_function_type</a>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> objective_function(<span class="keywordtype">int</span>* N_parameters, <span class="keyword">const</span> <span class="keywordtype">double</span>* state_vector, <span class="keywordtype">double</span>* objective_value, <span class="keywordtype">int</span>* failed, <a class="code" href="classmango_1_1Problem.html">mango::Problem</a>* problem, <span class="keywordtype">void</span>* void_user_data)</div>
</div><!-- fragment --><p>where <code>objective_function</code> can be replaced with any name you like. The array <code>state_vector</code> is an input to your subroutine, indicating the values of the independent variables for which the objective function is to be evaluated. <code>N_parameters</code> is also provided as an input to the subroutine for convenience, as it gives the size of the <code>state_vector</code> array. After your subroutine has computed the objective function, the result (a double) should be stored at the location pointed to by <code>objective_value</code>. If your calculation fails for some reason, you can return a value of 1 to <code>failed</code>; otherwise you can return 0 to <code>failed</code> or simply not set <code>failed</code>, since it defaults to 0.</p>
<p>The <a class="el" href="classmango_1_1Problem.html">mango::Problem</a> object representing the optimization problem is supplied to your subroutine as <code>problem</code>. This is often useful so your subroutine can use information related to MPI, e.g. communicating between group leaders and workers.</p>
<p>The argument <code>void_user_data</code> is a pointer to any data structure you supply via the method <a class="el" href="classmango_1_1Problem.html#a0f3dd62326265fee1e9b3a30de0cc399" title="Pass the prescribed pointer to the objective function whenever it is called.">mango::Problem::set_user_data()</a>. This argument is useful for passing information to your subroutine for the objective function, as discussed further below</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Defining the residuals for a least-squares problem</h1>
<p>If your problem has least-squares structure, then instead of supplying the objective function as described in the previous section, you must write a subroutine that computes the vector of residuals \(R_j\) described in <a class="el" href="concepts.html">Core Concepts</a>. This subroutine must have the form <a class="el" href="namespacemango.html#aa9d17e01eb4c624dd3b8abf0e4320599" title="Format for the user-supplied subroutine that computes the residuals for a least-squares optimization ...">mango::vector_function_type</a>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> residual_function(<span class="keywordtype">int</span>* N_parameters, <span class="keyword">const</span> <span class="keywordtype">double</span>* state_vector, <span class="keywordtype">int</span>* N_terms, <span class="keywordtype">double</span>* residuals, <span class="keywordtype">int</span>* failed, <a class="code" href="classmango_1_1Problem.html">mango::Problem</a>* problem, <span class="keywordtype">void</span>* void_user_data)</div>
</div><!-- fragment --><p>where <code>residual_function</code> can be replaced with any name you like. The array <code>state_vector</code> is an input to your subroutine, indicating the values of the independent variables for which the residuals are to be evaluated. <code>N_parameters</code> is also provided as an input to the subroutine for convenience, as it gives the size of the <code>state_vector</code> array. Note that your subroutine should compute \(R\), not \((R - T)/\sigma\) (using the notation from <a class="el" href="concepts.html">Core Concepts</a>); the \(T\) and \(\sigma\) arrays are set separately when you create the <a class="el" href="classmango_1_1Least__squares__problem.html">mango::Least_squares_problem</a> object. After your subroutine has computed the vector \(R\), the results should be stored at the array pointed to by <code>residuals</code>. The size of this array, <code>N_terms</code>, is provided as an input to the subroutine for convenience. If your calculation fails for some reason, you can return a value of 1 to <code>failed</code>; otherwise you can return 0 to <code>failed</code> or simply not set <code>failed</code>, since it defaults to 0.</p>
<p>The <a class="el" href="classmango_1_1Problem.html">mango::Problem</a> object representing the optimization problem (the parent of the <a class="el" href="classmango_1_1Least__squares__problem.html">mango::Least_squares_problem</a> you create) is supplied to your subroutine as <code>problem</code>. This is often useful so your subroutine can use information related to MPI, e.g. communicating between group leaders and workers.</p>
<p>The argument <code>void_user_data</code> is a pointer to any data structure you supply via the method <a class="el" href="classmango_1_1Problem.html#a0f3dd62326265fee1e9b3a30de0cc399" title="Pass the prescribed pointer to the objective function whenever it is called.">mango::Problem::set_user_data()</a>. This argument is useful for passing information to your subroutine for the objective function, as discussed further below.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Creating an optimization problem object</h1>
<p>An object representing a general optimization problem can be created in your code using the <a class="el" href="classmango_1_1Problem.html">mango::Problem</a> constructor:</p>
<div class="fragment"><div class="line"><a class="code" href="classmango_1_1Problem.html">mango::Problem</a> myprob(N_parameters, state_vector, &amp;objective_function, argc, argv);</div>
</div><!-- fragment --><p>where <code>myprob</code> can be changed to whatever name you wish. You should set the integer <code>N_parameters</code> to the number of independent variables. The values of these variables for the initial state should be stored in the user-allocated array <code>state_vector</code> (which has type <code>double*</code>). (As a general rule, MANGO gives the user responsibility for allocating memory.) The values of the <code>state_vector</code> array will not be copied or used until you actually invoke <a class="el" href="classmango_1_1Problem.html#a3084257fa4b76e9a8d42bf15aada7f12" title="Solve the optimization problem that has been set up.">mango::Problem::optimize</a>, so you are free to change the entries in <code>state_vector</code> after calling this constructor. After the optimization is completed, the same <code>state_vector</code> array will hold the location of the optimum found.</p>
<p>A pointer to the user-supplied subroutine for computing the objective function is given by the <code>&amp;objective_function</code> argument.</p>
<p>The last two arguments, <code>argc</code> (of type <code>int</code>) and <code>argv</code> (of type <code>char**</code>) allow arguments to be passed to the optimization libraries that MANGO calls. At present, only PETSc uses these arguments. If you do not wish to supply arguments, you are free to set <code>argc=0</code> and <code>argv=NULL</code>.</p>
<p>For problems with least-squares structure, then instead of creating a <a class="el" href="classmango_1_1Problem.html">mango::Problem</a> object, you should create a <a class="el" href="classmango_1_1Least__squares__problem.html">mango::Least_squares_problem</a> object:</p>
<div class="fragment"><div class="line"><a class="code" href="classmango_1_1Least__squares__problem.html">mango::Least_squares_problem</a> myprob(N_parameters, state_vector, N_terms, targets, sigmas, best_residual_function, &amp;residual_function, argc, argv);</div>
</div><!-- fragment --><p>Again, <code>myprob</code> can be replaced with whatever name you like. The arguments <code>N_parameters</code>, <code>state_vector</code>, <code>argc</code>, and <code>argv</code> have exactly the same meaning as for a general optimization problem. The integer <code>N_terms</code> provides the number of least-squares terms that are summed in the objective function, i.e. \(N_t\) in <a class="el" href="concepts.html">Core Concepts</a>. The double arrays <code>targets</code> and <code>sigmas</code>, both of size <code>N_terms</code>, correspond to the quantities \(T_j\) and \(\sigma_j\) in <a class="el" href="concepts.html">Core Concepts</a>, shifting and scaling the terms in the objective function. The double array <code>best_residual_function</code> will store the values of the residuals \(R_j\) at the optimum after the optimization is completed. Note that you have responsibility for allocating <code>targets</code>, <code>sigmas</code>, and <code>best_residual_function</code>. The argument <code>&amp;residual_function</code> is a pointer to the user-supplied subroutine for computing the residuals \(R_j\), and <code>residual_function</code> can be replaced by whichever subroutine name you use in your code.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Setting parameters</h1>
<p>A number of methods are provided for <a class="el" href="classmango_1_1Problem.html">mango::Problem</a> and <a class="el" href="classmango_1_1Least__squares__problem.html">mango::Least_squares_problem</a> objects to set options and parameters. To set the optimization algorithm, see <a class="el" href="algorithms.html">Available Algorithms</a>.</p>
<p>The method <a class="el" href="classmango_1_1Problem.html#adb4c7df669a9c245548d1ee4b9b759ce" title="Set the maximum number of evaluations of the objective function that will be allowed before the optim...">mango::Problem::set_max_function_evaluations</a> sets the maximum number of times the objective function will be evaluated, e.g.</p>
<div class="fragment"><div class="line">myprob.set_max_function_evaluations(1000);</div>
</div><!-- fragment --><p>This limit may be exceeded slightly because concurrent function evaluations will always be allowed to complete. For instance, if this limit is set to 1000, a finite-difference gradient calculation involving 10 function evaluations may be initiated when the objective function has been evaluated 995 times, resulting in 1005 evaluations in total.</p>
<p>To control whether centered or one-sided finite differences are used for gradient evaluations, use <a class="el" href="classmango_1_1Problem.html#aa4db74ed54d36de59eb442e0f0b5b932" title="Control whether 1-sided or centered finite differences will be used to compute derivatives of the obj...">mango::Problem::set_centered_differences</a>, e.g.</p>
<div class="fragment"><div class="line">myprob.set_centered_differences(<span class="keyword">false</span>);</div>
</div><!-- fragment --><p>The step size in the independent variables used for finite difference derivatives is set using <a class="el" href="classmango_1_1Problem.html#ad635ede68ce383d8efbc713e0bd31a99" title="Set an absolute step size for finite difference derivatives.">mango::Problem::set_finite_difference_step_size</a>:</p>
<div class="fragment"><div class="line">myprob.set_finite_difference_step_size(1.0e-6);</div>
</div><!-- fragment --><p>MANGO writes an ASCII file containing the history of evaluations of the objective function, and the name of this file can be set using <a class="el" href="classmango_1_1Problem.html#a67cf70869bebfa82d20f41af9354025c" title="Sets the name of the output file that will record values of the objective function at each evaluation...">mango::Problem::set_output_filename</a>:</p>
<div class="fragment"><div class="line">myprob.set_output_filename(<span class="stringliteral">&quot;mango_out.rosenbrock&quot;</span>);</div>
</div><!-- fragment --><p>where the string can be replaced by any filename you like.</p>
<p>For least-squares problems, this output file can be set to include or not include the values of the individual residual terms. It may be illuminating to view this information, though for problems with a large number of residual terms, it may be easier to read the output file if this large volume of information is suppressed. This choice can be controlled using <a class="el" href="classmango_1_1Least__squares__problem.html#ad58139fe5bda38d223580bc61bbd98dd" title="Determine whether or not to print each individual residual in the MANGO output file.">mango::Least_squares_problem::set_print_residuals_in_output_file</a>:</p>
<div class="fragment"><div class="line">myprob.set_print_residuals_in_output_file(<span class="keyword">false</span>);</div>
</div><!-- fragment --><p>If you wish, a separate output file can be generated containing the information about the MPI partition, e.g. which processors are in which worker group. This file can be written using <a class="el" href="classmango_1_1MPI__Partition.html#a781d9e624cb017791268c4aac3842ea7" title="Write a file with the given filename, showing the worker group assignments and rank of each process i...">mango::MPI_Partition::write</a>, e.g.</p>
<div class="fragment"><div class="line">myprob.mpi_partition.write(<span class="stringliteral">&quot;mango_mpi.rosenbrock&quot;</span>);</div>
</div><!-- fragment --><p>where the string can be replaced by any filename you like.</p>
<p>If you wish to impose bound constraints (also known as box constraints) on your problem, you can call <a class="el" href="classmango_1_1Problem.html#a5073840e5f67a229d7000435490f5e46" title="Sets bound constraints for the optimization problem.">mango::Problem::set_bound_constraints</a>, e.g.</p>
<div class="fragment"><div class="line">myprob.set_bound_constraints(lower_bounds, upper_bounds);</div>
</div><!-- fragment --><p>Here, <code>lower_bounds</code> and <code>upper_bounds</code> are of type <code>double*</code> and are user-allocated arrays of size <code>N_parameters</code>. Note that not all algorithms support bound constraints. The elements of these arrays are not copied or used until <a class="el" href="classmango_1_1Problem.html#a3084257fa4b76e9a8d42bf15aada7f12" title="Solve the optimization problem that has been set up.">mango::Problem::optimize</a> is called, so you can change the lower and upper bounds after the call to <a class="el" href="classmango_1_1Problem.html#a5073840e5f67a229d7000435490f5e46" title="Sets bound constraints for the optimization problem.">mango::Problem::set_bound_constraints</a>.</p>
<p>Alternatively, the related method <a class="el" href="classmango_1_1Problem.html#a0a9798d017c36128f39a1de07008203b" title="Impose bound constraints on an optimization problem, with the bounds chosen as multiples of the initi...">mango::Problem::set_relative_bound_constraints</a> lets you automatically set bound constraints based on a specified multiple of and/or distance from the initial condition. For instance, to let each parameter vary between 0.5 and 2 times its initial value, you can call</p>
<div class="fragment"><div class="line">myprob.set_relative_bound_constraints(0.5, 2.0, 0.0, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>MANGO's Levenberg-Marquardt algorithm uses a parallelized line search in which, by default, the number of values of the \(\lambda\) parameter considered between Jacobian evaluations is equal to the number of worker groups. This choice generally makes the best use of parallelization, but it makes the optimization history depend on the number of worker groups, and hence possibly on the number of MPI processes. You may occasionally wish for the number of values of \(\lambda\) examined to be some specified value different from the number of worker groups, particularly for tests related to parallelization. In this case, you can specify the number of \(\lambda\) values to use with <a class="el" href="classmango_1_1Problem.html#a9fba6faf2fb3eadddd0a77876de81342" title="Sets the number of points considered as a set for parallel line searches.">mango::Problem::set_N_line_search</a>, e.g.</p>
<div class="fragment"><div class="line">myprob.set_N_line_search(3);</div>
</div><!-- fragment --><p>By default, MANGO will not print information to stdout. To turn on the printing of information for debugging you can use <a class="el" href="classmango_1_1Problem.html#a564f15194cdb34d07eff8960fdac79ff" title="Control how much diagnostic information is printed by MANGO.">mango::Problem::set_verbose</a>, e.g.</p>
<div class="fragment"><div class="line">myprob.set_verbose(1);</div>
</div><!-- fragment --><p>You can pass any variable or data structure to your subroutine for the objective function or residuals using <a class="el" href="classmango_1_1Problem.html#a0f3dd62326265fee1e9b3a30de0cc399" title="Pass the prescribed pointer to the objective function whenever it is called.">mango::Problem::set_user_data</a>, e.g.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> mydata = 42;</div>
<div class="line">myprob.set_user_data(&amp;mydata);</div>
</div><!-- fragment --><p>The pointer that you provide will be passed to your subroutine for the objective function or residuals as the <code>user_data</code> argument, which has type <code>void*</code>. (See <a class="el" href="namespacemango.html#a00722de214a374d91aff46c5c42d00be" title="Format for the user-supplied subroutine that computes the objective function for a general (non least...">mango::objective_function_type</a> and <a class="el" href="namespacemango.html#aa9d17e01eb4c624dd3b8abf0e4320599" title="Format for the user-supplied subroutine that computes the residuals for a least-squares optimization ...">mango::vector_function_type</a>.) In this subroutine you must cast the pointer from <code>void*</code> to the appropriate type for your data.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
MPI considerations</h1>
<p>Your code (not MANGO) is responsible for calling <code>MPI_Init()</code> and <code>MPI_Finalize()</code>.</p>
<p>The set of MPI processes must be divided up into worker groups. This can either be done by MANGO or you are welcome to do it yourself. It is strongly recommended to have MANGO handle the division into worker groups. In this case, you can set the number of worker groups using <a class="el" href="classmango_1_1MPI__Partition.html#ae458085adce912463e718c56b9909660" title="Set the number of worker groups to the given integer.">mango::MPI_Partition::set_N_worker_groups</a>. Then, after calling <code>MPI_Init</code>, call <a class="el" href="classmango_1_1Problem.html#ae2fd8762c2802c59b3d6d38b7760496d" title="Initialize MANGO&#39;s internal MPI data that describes the partitioning of the processes into worker gro...">mango::Problem::mpi_init</a> as follows:</p>
<div class="fragment"><div class="line">myprob.mpi_partition.set_N_worker_groups(5);</div>
<div class="line">myprob.mpi_init(MPI_COMM_WORLD);</div>
</div><!-- fragment --><p>where <code>myprob</code> is the name of the <a class="el" href="classmango_1_1Problem.html">mango::Problem</a> object you have created. If you want MANGO to only use a subset of the processes in <code>MPI_COMM_WORLD</code>, then use the appropriate MPI communicator in the code line above. If you have selected an optimization algorithm that does not support concurrent function evaluations, MANGO will automatically change the number of worker groups to 1.</p>
<p>If you prefer to do your own division of processes into worker groups, you can call <a class="el" href="classmango_1_1MPI__Partition.html#a045da61507d0df8928fa799e307fa756" title="Use a user-supplied partitioning of the MPI processes into worker groups.">mango::MPI_Partition::set_custom</a> instead of <a class="el" href="classmango_1_1Problem.html#ae2fd8762c2802c59b3d6d38b7760496d" title="Initialize MANGO&#39;s internal MPI data that describes the partitioning of the processes into worker gro...">mango::Problem::mpi_init</a>.</p>
<p>Once MANGO's MPI information has been initialized by one of these two methods, methods are available to get the three MPI communicators discussed in <a class="el" href="concepts.html">Core Concepts</a>, <a class="el" href="classmango_1_1MPI__Partition.html#a0242188fdd59e2574273618a9e78eb51" title="Get the MPI communicator for MANGO&#39;s world communicator.">mango::MPI_Partition::get_comm_world</a>, <a class="el" href="classmango_1_1MPI__Partition.html#aec90074e9d1d80abaac83cdf8cd6daf7" title="Get the MPI communicator for MANGO&#39;s &quot;worker groups&quot; communicator.">mango::MPI_Partition::get_comm_worker_groups</a>, and <a class="el" href="classmango_1_1MPI__Partition.html#a0dca546564af54d62f5cb4a29800e37c" title="Get the MPI communicator for MANGO&#39;s &quot;group leaders&quot; communicator.">mango::MPI_Partition::get_comm_group_leaders</a>. The number of processes in each communicator can be queried with <a class="el" href="classmango_1_1MPI__Partition.html#aae7a7fdb006336be42b47a654ca1fd6b" title="Get the number of processors in MANGO&#39;s world communicator.">mango::MPI_Partition::get_N_procs_world</a>, <a class="el" href="classmango_1_1MPI__Partition.html#a8bc5e256147123d59c9ed8e75476426e" title="Get the number of processors in MANGO&#39;s &quot;worker groups&quot; communicator.">mango::MPI_Partition::get_N_procs_worker_groups</a>, and <a class="el" href="classmango_1_1MPI__Partition.html#a3c0badbbfcf6a39838592f1706ca3caf" title="Get the number of processors in MANGO&#39;s &quot;group leaders&quot; communicator.">mango::MPI_Partition::get_N_procs_group_leaders</a>. The rank of a given process within each of the communicators can be obtained with <a class="el" href="classmango_1_1MPI__Partition.html#ac839a1e5ba8b167dba9a632103983682" title="Get the MPI rank of this processor in MANGO&#39;s world communicator.">mango::MPI_Partition::get_rank_world</a>, <a class="el" href="classmango_1_1MPI__Partition.html#a87f2f659e8b17da68c9dc48a54d58010" title="Get the MPI rank of this processor in MANGO&#39;s &quot;worker groups&quot; communicator.">mango::MPI_Partition::get_rank_worker_groups</a>, and <a class="el" href="classmango_1_1MPI__Partition.html#a3f01f33ea2b75605565d9531ebf74d4f" title="Get the MPI rank of this processor in MANGO&#39;s &quot;group leaders&quot; communicator.">mango::MPI_Partition::get_rank_group_leaders</a>. To determine if a given process has rank = 0 within a given communicator, you can call <a class="el" href="classmango_1_1MPI__Partition.html#aaf8ba1d9f8df15f56e1ca937678a2804" title="Determine whether this MPI processor has rank 0 in MANGO&#39;s world communicator.">mango::MPI_Partition::get_proc0_world</a> and <a class="el" href="classmango_1_1MPI__Partition.html#a4d5cb2c4cc80866f562e5a429fb3ed17" title="Determine whether this MPI processor has rank 0 in MANGO&#39;s &quot;worker groups&quot; communicator.">mango::MPI_Partition::get_proc0_worker_groups</a>. The number of worker groups and the worker group that a given process belongs to can be found using <a class="el" href="classmango_1_1MPI__Partition.html#adc3a4a24041ee4051b7629473bf8dfc1" title="Returns the number of worker groups.">mango::MPI_Partition::get_N_worker_groups</a> and <a class="el" href="classmango_1_1MPI__Partition.html#a6df1119cf20b64c5cab6525df1ac3639" title="Returns an integer indicating the worker group to which this MPI process belongs.">mango::MPI_Partition::get_worker_group</a>.</p>
<p>MANGO provides several methods that may be convenient for handling communication between group leaders and workers: <a class="el" href="classmango_1_1MPI__Partition.html#ac94eaaeb86706c8a66a7c6516c43f678" title="Tell the worker MPI processes (i.e. those that are not group leaders) to begin an evaluation of the o...">mango::MPI_Partition::mobilize_workers</a>, <a class="el" href="classmango_1_1MPI__Partition.html#a6426ae4080ba7ace81b9f5494fd273d6" title="Tell the worker MPI processes (i.e. those that are not group leaders) that the optimization problem i...">mango::MPI_Partition::stop_workers</a>, and <a class="el" href="classmango_1_1MPI__Partition.html#a9c054d572a105a510cb5f6436dddfd31" title="For an MPI worker, determine whether to carry out another evaluation of the objective function or exi...">mango::MPI_Partition::continue_worker_loop</a>. Use of these methods is optional. These methods are demonstrated in all of the <a href="https://github.com/hiddenSymmetries/mango/tree/master/examples/src">examples</a>. In typical usage, workers use <a class="el" href="classmango_1_1MPI__Partition.html#a9c054d572a105a510cb5f6436dddfd31" title="For an MPI worker, determine whether to carry out another evaluation of the objective function or exi...">mango::MPI_Partition::continue_worker_loop</a> to wait until they are needed to evaluate the objective function, and exit when the optimization is complete:</p>
<div class="fragment"><div class="line"><span class="comment">// This code is run only by workers, not group leaders.</span></div>
<div class="line"><span class="keywordflow">while</span> (myprob-&gt;mpi_partition.continue_worker_loop()) {</div>
<div class="line">  <span class="comment">// Here, communicate with my group leader via MPI and help it to evaluate the objective function.</span></div>
<div class="line">}</div>
<div class="line"><span class="comment">// We exit the above loop when mango::Problem::optimize() completes.</span></div>
</div><!-- fragment --><p>Meanwhile, a group leader causes its workers to evaluate the code inside the above <code>while</code> loop (i.e. causes <a class="el" href="classmango_1_1MPI__Partition.html#a9c054d572a105a510cb5f6436dddfd31" title="For an MPI worker, determine whether to carry out another evaluation of the objective function or exi...">mango::MPI_Partition::continue_worker_loop</a> to evaluate to <code>true</code>) by calling <a class="el" href="classmango_1_1MPI__Partition.html#ac94eaaeb86706c8a66a7c6516c43f678" title="Tell the worker MPI processes (i.e. those that are not group leaders) to begin an evaluation of the o...">mango::MPI_Partition::mobilize_workers</a> inside the user-supplied subroutine for the objective or residual function, e.g.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> objective_function(<span class="keywordtype">int</span>* N_parameters, <span class="keyword">const</span> <span class="keywordtype">double</span>* state_vector, <span class="keywordtype">double</span>* objective_value, <span class="keywordtype">int</span>* failed, <a class="code" href="classmango_1_1Problem.html">mango::Problem</a>* problem, <span class="keywordtype">void</span>* void_user_data) {</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">  problem-&gt;<a class="code" href="classmango_1_1Problem.html#a1db62b9befe670a32dcbee99f6e37f3f">mpi_partition</a>.<a class="code" href="classmango_1_1MPI__Partition.html#ac94eaaeb86706c8a66a7c6516c43f678">mobilize_workers</a>();</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>When the group leaders are done with the optimization, they should instruct the workers to exit the <code>while</code> loop above:</p>
<div class="fragment"><div class="line">myprob.mpi_partition.stop_workers();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Running the optimization</h1>
<p>Once parameters have been set, the optimization is actually performed with the method <a class="el" href="classmango_1_1Problem.html#a3084257fa4b76e9a8d42bf15aada7f12" title="Solve the optimization problem that has been set up.">mango::Problem::optimize</a>. The lowest value of the objective function is returned, e.g.</p>
<div class="fragment"><div class="line">best_objective_function = myprob.optimize();</div>
</div><!-- fragment --><p>The method <a class="el" href="classmango_1_1Problem.html#a3084257fa4b76e9a8d42bf15aada7f12" title="Solve the optimization problem that has been set up.">mango::Problem::optimize</a> should be called by all group leaders, but not by workers.</p>
<p>Once <a class="el" href="classmango_1_1Problem.html#a3084257fa4b76e9a8d42bf15aada7f12" title="Solve the optimization problem that has been set up.">mango::Problem::optimize</a> has completed, the values of the independent variables at the optimum are available in the <code>state_vector</code> array you provided to the <a class="el" href="classmango_1_1Problem.html">mango::Problem</a> constructor. Further details of the optimization can be obtained using <a class="el" href="classmango_1_1Problem.html#af7a13191cabfae3380f26a4db673537c" title="For an optimization problem that has already been solved, return the number of times the objective fu...">mango::Problem::get_function_evaluations</a> and <a class="el" href="classmango_1_1Problem.html#abfc0b5cbade22b1b69082fc74561c625" title="For an optimization problem that has already been solved, return the index of the function evaluation...">mango::Problem::get_best_function_evaluation</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclassmango_1_1Problem_html_a1db62b9befe670a32dcbee99f6e37f3f"><div class="ttname"><a href="classmango_1_1Problem.html#a1db62b9befe670a32dcbee99f6e37f3f">mango::Problem::mpi_partition</a></div><div class="ttdeci">MPI_Partition mpi_partition</div><div class="ttdef"><b>Definition:</b> <a href="mango_8hpp_source.html#l00449">mango.hpp:449</a></div></div>
<div class="ttc" id="aclassmango_1_1Least__squares__problem_html"><div class="ttname"><a href="classmango_1_1Least__squares__problem.html">mango::Least_squares_problem</a></div><div class="ttdef"><b>Definition:</b> <a href="mango_8hpp_source.html#l00658">mango.hpp:658</a></div></div>
<div class="ttc" id="amango_8hpp_html"><div class="ttname"><a href="mango_8hpp.html">mango.hpp</a></div></div>
<div class="ttc" id="aclassmango_1_1MPI__Partition_html_ac94eaaeb86706c8a66a7c6516c43f678"><div class="ttname"><a href="classmango_1_1MPI__Partition.html#ac94eaaeb86706c8a66a7c6516c43f678">mango::MPI_Partition::mobilize_workers</a></div><div class="ttdeci">void mobilize_workers()</div><div class="ttdoc">Tell the worker MPI processes (i.e. those that are not group leaders) to begin an evaluation of the o...</div><div class="ttdef"><b>Definition:</b> <a href="mpi__partition_8cpp_source.html#l00118">mpi_partition.cpp:118</a></div></div>
<div class="ttc" id="aclassmango_1_1Problem_html"><div class="ttname"><a href="classmango_1_1Problem.html">mango::Problem</a></div><div class="ttdef"><b>Definition:</b> <a href="mango_8hpp_source.html#l00442">mango.hpp:442</a></div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</body>
</html>
